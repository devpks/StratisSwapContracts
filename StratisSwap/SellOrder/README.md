# Sell Order Contract

A contract used to request a specific amount of an SRC token at a specifed price. Receives CRS tokens after successfully transferring SRC tokens.

## Use Case

Johnny wants to sell 10 SRC tokens at .1 CRS each. Johnny creates a new **SellOrder** contract specifying the token address he wants to sell, at what price (in satoshis) and how many. The contract will validate Johnny's inputs and be created.

After the contract is created, Johnny must call the `Approve` method on the token's contract that he wants to sell and _Approve_ the new order's contract address to spend at least the amount that he wants to sell.

This contract will release SRC tokens to buyers after validations. After successful transfers of SRC, the contract will release CRS to the seller.

## Creating the Contract

### Hash

```text
b76fe3ec16361fb743f84ac9fde7e3ec844e1c03bd84dff497433bb5d5bc6013
```

### ByteCode

```text
4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010200D4393BDA0000000000000000E00022200B013000001000000002000000000000022E0000002000000040000000000010002000000002000004000000000000000400000000000000006000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000B02D00004F000000000000000000000000000000000000000000000000000000004000000C000000942D00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000080E0000002000000010000000020000000000000000000000000000200000602E72656C6F6300000C000000004000000002000000120000000000000000000000000000400000420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E42D00000000000048000000020005006C230000280A000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001330030057000000000000000203280600000A0205166AFE037201000070280700000A020E04166AFE03723B000070280700000A0204280300000602052805000006020E0428070000060202280800000A6F0900000A28090000060217280B0000062A4602280A00000A72770000706F0B00000A2A4A02280A00000A7277000070036F0C00000A2A4602280A00000A72830000706F0D00000A2A4A02280A00000A7283000070036F0E00000A2A4602280A00000A728F0000706F0D00000A2A4A02280A00000A728F000070036F0E00000A2A4602280A00000A729D0000706F0B00000A2A4A02280A00000A729D000070036F0C00000A2A4602280A00000A72AB0000706F0F00000A2A4A02280A00000A72AB000070036F1000000A2A1330080065010000010000110202280A00000672BD000070280700000A0202280800000A6F0900000A022808000006281100000A72ED000070280700000A0228060000060334080228060000062B0103100102280400000603D90A0202280800000A6F1200000A06FE0516FE01721D010070280700000A02022802000006166A725D010070198D0E00000125160228080000068C08000001A2251702280800000A6F0900000A8C08000001A22518038C0F000001A2166A281300000A0B02076F1400000AA5100000017277010070280700000A0202280800000606281500000A2602280800000A6F1200000A06DB0C08166A36130202280800000A6F0900000A08281500000A260202280600000603DB28070000060228060000062D070216280B0000061204FE1503000002120402280800000A6F0900000A7D0100000412040228040000067D020000041204037D03000004120402281600000A6F1700000A7D0400000411040D0209280100002B092AA60202280800000A6F0900000A022808000006281900000A729B010070280700000A0216280B0000062A001330020057000000020000111200FE150400000212000228080000067D0500000412000228020000067D0600000412000228040000067D0700000412000228060000067D08000004120002280A0000067D0A000004120072B90100707D09000004062A0042534A4201000100000000000C00000076342E302E33303331390000000005006C000000A0030000237E00000C0400002403000023537472696E67730000000030070000D00100002355530000090000100000002347554944000000100900001801000023426C6F6200000000000000020000015715A201090A000000FA0133001600000100000011000000040000000A0000000E0000000A00000019000000050000000200000001000000050000000A00000001000000020000000200000001000000000089010100000000000600D80049020600170149020600C40036020F00690200000A0007019E020A00B5029E020A0078009E020A0096029E020A00CA029E0206006400AB010A00F8009E020A004F009E020A009F009E020600C302AB0106000E00AB010600B201AB010A0073019E02000000001500000000000100010001001000010200001900010001000A011000D4010000290001000F000A0110007B020000290005000F0006002A029C0006004300A0000600E902A00006007E01A000060023029C000600C8019C0006004300A0000600E902A00006006E00A30006006601A60050200000000086183002A9000100B320000000008608BA0121000500C520000000008108C401B3000500D820000000008608350061000600EA200000000081083F00B9000600FD20000000008608DA02610007000F21000000008108E502B9000700222100000000860814022100080034210000000081081F02B300080047210000000086085501BE00090059210000000081086201C20009006C210000000086002003C7000A00DD22000000008600F60106000B0008230000000086007802CD000B00000001008C0000000200CE0100000300490000000400F002000001004F01000001004F01000001004F01000001004F01000001004F01000001001803090030020100110030020600190030020A002900300206005900300206003100300210003100F7021600310058001C006100EB0121003100B0002600690088022B0069009302310069000100380069000B003D0069009B0143006900A301480041000A03590061003501610031008401650049003F01710031000B02750031007A017D008900E001610031006F0182004100FE02590021002B0010012E000B00DF002E001300E8002E001B0007014300230010014E008E00020001000000C801D20000004300D7000000E902D70000002302D20000006601DB0002000200030001000300030002000400050001000500050002000600070001000700070002000800090001000900090002000A000B0001000B000B00048000000000000000000000000000000000B502000004000000000000000000000093001E000000000001000200010000000000000000009E0200000000030002000400020031008900000000000047657455496E7436340053657455496E743634003C4D6F64756C653E0053797374656D2E507269766174652E436F72654C6962006765745F5072696365007365745F507269636500707269636500494D657373616765006765745F4D6573736167650056616C756554797065004F72646572547970650049536D617274436F6E7472616374537461746500736D617274436F6E74726163745374617465004950657273697374656E745374617465006765745F50657273697374656E7453746174650044656275676761626C6541747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500496E646578417474726962757465004465706C6F794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C7565006765745F52657475726E56616C75650076616C7565006765745F4973416374697665007365745F4973416374697665004C6F670049426C6F636B006765745F426C6F636B0043616C6C00536D617274436F6E74726163742E646C6C00476574426F6F6C00536574426F6F6C0053797374656D00426F6F6C65616E006765745F546F6B656E007365745F546F6B656E00746F6B656E005472616E73616374696F6E006765745F4E756D626572006765745F53656E64657200436C6F73654F726465720053656C6C4F72646572005472616E73666572006765745F53656C6C6572007365745F53656C6C6572004275796572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F646573004765744F7264657244657461696C730047657441646472657373005365744164647265737300537472617469732E536D617274436F6E74726163747300536D617274436F6E7472616374004F626A65637400495472616E73666572526573756C74006765745F416D6F756E74007365745F416D6F756E7400616D6F756E7400417373657274006F705F457175616C697479006F705F496E657175616C69747900616D6F756E74546F4275790000395000720069006300650020006D007500730074002000620065002000670072006500610074006500720020007400680061006E0020003000003B41006D006F0075006E00740020006D007500730074002000620065002000670072006500610074006500720020007400680061006E0020003000000B54006F006B0065006E00000B50007200690063006500000D41006D006F0075006E007400000D530065006C006C0065007200001149007300410063007400690076006500002F43006F006E007400720061006300740020006900730020006E006F00740020006100630074006900760065002E00002F530065006E006400650072002000630061006E006E006F00740020006200650020006F0077006E00650072002E00003F4E006F007400200065006E006F007500670068002000660075006E0064007300200074006F00200063006F00760065007200200063006F00730074002E0000195400720061006E007300660065007200460072006F006D0000235400720061006E00730066006500720020006600610069006C007500720065002E00001D41007300730065007200740020006600610069006C00650064002E000013530065006C006C004F007200640065007200000000008A69CF1712FDDB4E9FCD809AAE1E77830004200101080320000105200101111105200101121D05200201020E04200012310420001121042000123505200111210E062002010E11210420010B0E052002010E0B042001020E052002010E020A07050B12250B110C110C07000202112111210320000B0B2005122511210B0E1D1C0B0320001C072002122511210B042000124506300101011E00040A01110C0407011110087CEC85D7BEA7798E0306112102060B02060E02060209200401121D11210B0B052001011121042001010B032000020420010102052001110C0B042000111004280011210328000B032800020801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301080100020000000000040100000000000000000000000000000000000010000000000000000000000000000000D82D00000000000000000000F22D0000002000000000000000000000000000000000000000000000E42D0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000043E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

### Parameters

- `Address address` - The contract address of the token for sale.
- `ulong price` - The amount of CRS per SRC token in satoshis (e.g. 1CRS = 100_000_000).
- `ulong amount` - The amount of SRC tokens to sell in full. (e.g. 1 for 1SRC token)

### Post Deployment

After the contract is created the new contract address must be approved to spend the amount of SRC tokens specified in the `amount` parameter. Using Stratis Swap UI, this will be done for you.

- Call the `Approve(Address newOrderContractAddress, ulong oldBalance, ulong amount)` method at the provided `address` of the SRC token to be orderd.

Upon success, the `newOrderContractAddress` will have the required allowance to allow buyers to fill the order.

## Closing the contract

The creator of the contract has abilities to cancel the contract. This sets the `IsActive` flag to false preventing further user interaction.

- Call the `CloseOrder` method on the order contract address from the wallet address that created the order.

## Get Order Details

Prior to attempting to settle a contract, make a local call to `GetOrderDetails` to preview the contracts state.

```json
{
  "orderType": "SellOrder",
  "price": 10000000,
  "amount": 10,
  "isActive": true,
  "seller": "CV9FGxmLHxnpHwu2AmLKKuRUBjGX1yzkCZ",
  "token": "Cam6mmCcCv4zZN65ppF28tHLhT2DfwuU26"
}
```

**Note** - You may also want to make a local call to the SRC tokens contract to verify that the order contract address is approved to send the necessary amount of tokens prior to attempting to settle a contract. Safe gaurds are in place if the contract isn't properly approved, but gas for calling the contract will be spent.

## Filling a Order

For sell orders, all orders looking to fill the contract will call the `Buy(ulong amountToPurchase)` method supplying the amount of SRC tokens they'd like to purchase as a parameter.

- Validations are run against contract details and buyer supplied parameters.
- SRC token amount is sent to `Message.Sender` (the buyer).
  - Upon failure, no funds will move.
  - Upon success, CRS tokens are transferred to the seller (owner of the contract).
- Any remaining balance from `Message.Sender` (the buyer) is returned to them
- Checks if there is a remaining `Amount` of SRC tokens to sell.
  - If fully filled - close contract and return `Transaction` result
  - If not fully filled - Update `Amount` and return `Transaction` result
    - Other Buyers can come and buy the remaining `Amount` until the order is closed or fully filled.

```json
// Logged and returned transaction JSON
{
  "buyer": "CNXp26iEE3EbJC9RRLBZ2cYnP7a8L3Z84F",
  "price": 10000000,
  "amount": 10,
  "block": 12345
}
```
