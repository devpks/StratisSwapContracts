# Sell Offer Contract

A contract used to request a specific amount of an SRC token at a specifed price. Receives CRS tokens after successfully transferring SRC tokens.

## Use Case

Johnny wants to sell 10 SRC tokens at .1 CRS each. Johnny creates a new **SellOffer** contract specifying the token address he wants to sell, how many and at what price (in satoshis). The contract will validate Johnny's inputs and be created.

After the contract is created, Johnny must call the `Approve` method on the token's contract that he wants to sell and _Approve_ the new offer's contract address to spend at least the amount that he is offering to sell. If Johnny is using CirrusSwapUI, this will do it for him but comes with a cost of the extra calls gas price.

This contract will release SRC tokens to buyers after validations. After transfer success of SRC, the contract will release CRS to the seller.

## Creating the Contract

### Hash

```text
9221fa952e55ad027599b48d3c70743f0b1b656e8664f63d3fec78ed4bb9b7f1
```

### ByteCode

```text
4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010200FD2DD2820000000000000000E00022200B0130000010000000020000000000000E2E0000002000000040000000000010002000000002000004000000000000000400000000000000006000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000BC2D00004F000000000000000000000000000000000000000000000000000000004000000C000000A02D00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000140E0000002000000010000000020000000000000000000000000000200000602E72656C6F6300000C000000004000000002000000120000000000000000000000000000400000420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F02D000000000000480000000200050078230000280A000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001330030057000000000000000203280600000A0205166AFE037201000070280700000A020E04166AFE03723B000070280700000A0204280300000602052805000006020E0428070000060202280800000A6F0900000A28090000060217280B0000062A4602280A00000A72770000706F0B00000A2A4A02280A00000A7277000070036F0C00000A2A4602280A00000A72910000706F0D00000A2A4A02280A00000A7291000070036F0E00000A2A4602280A00000A72A70000706F0D00000A2A4A02280A00000A72A7000070036F0E00000A2A4602280A00000A72BF0000706F0B00000A2A4A02280A00000A72BF000070036F0C00000A2A4602280A00000A72CD0000706F0F00000A2A4A02280A00000A72CD000070036F1000000A2A1330080071010000010000110202280A00000672DF000070280700000A0202280800000A6F0900000A022808000006281100000A72DF000070280700000A0228060000060334080228060000062B0103100102280400000603D90A0202280800000A6F1200000A06FE0516FE0172FD000070280700000A02022802000006166A7245010070198D0E00000125160228080000068C08000001A2251702280800000A6F0900000A8C08000001A22518038C0F000001A2166A281300000A0B02076F1400000AA51000000172DF000070280700000A0202280800000606281500000A2602280800000A6F1200000A06DB0C08166A36130202280800000A6F0900000A08281500000A2602280600000603DB0D09166A3609020928070000062B070216280B0000061205FE1503000002120502280800000A6F0900000A7D0100000412050228040000067D020000041205037D030000041205067D04000004120502281600000A6F1700000A7D0500000411051304021104280100002B11042AA60202280800000A6F0900000A022808000006281900000A72DF000070280700000A0216280B0000062A001330020057000000020000111200FE150400000212000228080000067D0600000412000228020000067D0700000412000228040000067D0800000412000228060000067D090000041200725F0100707D0A000004120002280A0000067D0B000004062A0042534A4201000100000000000C00000076342E302E33303331390000000005006C000000A4030000237E0000100400007C03000023537472696E6773000000008C070000740100002355530000090000100000002347554944000000100900001801000023426C6F6200000000000000020000015715A201090A000000FA0133001600000100000011000000040000000B0000000E0000000A00000019000000050000000200000001000000050000000A000000010000000200000002000000010000000000BF0101000000000006000E015A0206004D015A020600FA0047020F007A0200000A003D01EC020A000303EC020A00AE00EC020A00E402EC020A001803EC0206009300E1010A002E01EC020A007400EC020A00D500EC0206001103E10106000E00E1010600E801E1010A00A901EC02000000001500000000000100010001001000120200001900010001000A011000F0010000290001000F000A0110008C020000290006000F0006003B029D0006005300A10006003C03A10006003500A1000600B401A1000600C8029D000600AE029D0006005300A10006003C03A10006008900A40006009C01A70050200000000086184102AA000100B320000000008608990221000500C520000000008108AA02B4000500D820000000008608400062000600EA200000000081084F00BA000600FD200000000086082803620007000F210000000081083803BA000700222100000000860825022100080034210000000081083002B400080047210000000086088B01BF00090059210000000081089801C30009006C210000000086007503C8000A00E922000000008600690006000B0014230000000086008902CE000B0000000100C20000000200BB02000003005E00000004004803000001008501000001008501000001008501000001008501000001008501000001009D00090041020100110041020600190041020A0029004102060059004102060031004102100031005403160031007D001C006100070221003100E60026006900D6022B006900E102310069000100380069000B003D006900D10143006900D9014800410067035A0061006B0162003100BA01660049007501720031001C0276003100B0017E008900FC0162003100A501830041005B035A0021002B0011012E000B00E0002E001300E9002E001B0008014300230011014E008F00020001000000AE02D30000005300D80000003C03D80000003402D30000009C01DC0002000200030001000300030002000400050001000500050002000600070001000700070002000800090001000900090002000A000B0001000B000B000480000000000000000000000000000000000303000004000000000000000000000094001E00000000000100020001000000000000000000EC0200000000030002000400020031008A0000000047657455496E7436340053657455496E743634003C4D6F64756C653E0053797374656D2E507269766174652E436F72654C696200546F74616C5072696365006765745F546F6B656E5072696365007365745F546F6B656E507269636500746F6B656E507269636500436C6F7365547261646500494D657373616765006765745F4D657373616765005472616465547970650056616C75655479706500616D6F756E74546F50757263686173650049536D617274436F6E7472616374537461746500736D617274436F6E74726163745374617465004950657273697374656E745374617465006765745F50657273697374656E7453746174650044656275676761626C6541747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500496E646578417474726962757465004465706C6F794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C7565006765745F52657475726E56616C75650076616C7565006765745F4973416374697665007365745F4973416374697665004C6F670049426C6F636B006765745F426C6F636B0043616C6C00536D617274436F6E74726163742E646C6C00476574426F6F6C00536574426F6F6C0053797374656D00426F6F6C65616E005472616E73616374696F6E006765745F4E756D626572006765745F53656E6465720053656C6C4F66666572005472616E73666572006765745F53656C6C6572007365745F53656C6C6572004275796572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F64657300476574547261646544657461696C73006765745F546F6B656E41646472657373007365745F546F6B656E4164647265737300746F6B656E416464726573730053656C6C6572416464726573730047657441646472657373005365744164647265737300537472617469732E536D617274436F6E74726163747300536D617274436F6E7472616374004F626A65637400495472616E73666572526573756C74006765745F546F6B656E416D6F756E74007365745F546F6B656E416D6F756E7400746F6B656E416D6F756E7400417373657274006F705F457175616C697479006F705F496E657175616C697479004275790000000000395000720069006300650020006D007500730074002000620065002000670072006500610074006500720020007400680061006E0020003000003B41006D006F0075006E00740020006D007500730074002000620065002000670072006500610074006500720020007400680061006E0020003000001954006F006B0065006E004100640064007200650073007300001554006F006B0065006E0050007200690063006500001754006F006B0065006E0041006D006F0075006E007400000D530065006C006C0065007200001149007300410063007400690076006500001D41007300730065007200740020006600610069006C00650064002E0000474E006F007400200065006E006F007500670068002000660075006E0064007300200074006F00200063006F007600650072002000700075007200630068006100730065002E0000195400720061006E007300660065007200460072006F006D000013530065006C006C004F006600660065007200000017787C82DA3E1349A653C81501A2196B0004200101080320000105200101111105200101121D05200201020E04200012310420001121042000123505200111210E062002010E11210420010B0E052002010E0B042001020E052002010E020B07060B12250B0B110C110C07000202112111210320000B0B2005122511210B0E1D1C0B0320001C072002122511210B042000124506300101011E00040A01110C0407011110087CEC85D7BEA7798E0306112102060B02060E02060209200401121D11210B0B052001011121042001010B032000020420010102052001110C0B042000111004280011210328000B032800020801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000200000000000401000000000000000000000000000000000010000000000000000000000000000000E42D00000000000000000000FE2D0000002000000000000000000000000000000000000000000000F02D0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000103E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

### Parameters

- `Address tokenAddress` - The contract address of the token for sale.
- `ulong tokenPrice` - The amount of CRS per SRC token in satoshis (e.g. 1CRS = 100_000_000).
- `ulong tokenAmount` - The amount of SRC tokens to sell in full. (e.g. 1 for 1SRC token)

### Post Deployment

After the contract is created the new contract address must be approved to spend the amount of SRC tokens specified in the `tokenAmount` parameter. Using CirrusSwapUI, this will be done for you.

- Call the `Approve(Address tradeContractAddress, ulong oldBalance, ulong newBalance)` method at the `tokenAddress` of the SRC tokent to be traded.
  - Supply the new trade contract address to spend the `tokenAmount` specified.
- Upon success, the `tradeContract` address will have an allowance that will be used to settle the transaction.

## Closing the contract

The creator of the contract has abilities to cancel the contract. This sets the `IsActive` flag to false preventing further user interaction.

- Call the `CloseTrade` method on the trade contract address

## Get Trade Details

Prior to attempting to settle a contract, make a local call to `GetTradeDetails` to preview the contracts state. Returns a `TradeDetails` struct.

```csharp
public struct TradeDetails
{
  public Address SellerAddress;  // Address of the seller
  public Address TokenAddress;   // Address of SRC token for sale
  public ulong TokenPrice;       // Ask price of each SRC token
  public ulong TokenAmount;      // Amount of SRCToken for sale
  public string TradeType;       // Returns "SellOffer"
  public bool IsActive;          // True if trade is open
}
```

**Note** - Prior to attempting to settle a sell contract, you may also want to make a local call to the SRC tokens contract to verify that the contract address is approved to send the necessary amount of SRC tokens. Safe gaurds are in place for the contract isn't properly approved, but gas for calling the contract will be lost.

## Filling a Trade

For sell offers, all trades looking to fill the contract will call the `Buy(ulong amountToPurchase)` method supplying the amount of SRC tokens they'd like to purchase as a parameter.

- Validations are run against contract details and buyer supplied parameters.
- SRC token amount is sent to `Message.Sender` (the buyer).
  - Upon failure, no funds will move.
  - Upon success, CRS tokens are transferred to the seller (owner of the contract).
- Any remaining balance from `Message.Sender` (the buyer), return to them
- Check if the `TokenAmount` to sell is 0 or if the contract is not fully filled.
  - If fully filled - close contract and return `Transaction` result
  - If not full filled - Update `TokenAmount` and return `Transaction` result

```csharp
public struct Transaction
{
    [Index]
    public Address Buyer;
    public ulong TokenPrice;  // Price of each SRC token sold
    public ulong TokenAmount; // Amout of SRC token sold
    public ulong TotalPrice;  // Total price of transaction
    public ulong Block;       // The block number it was executed on
}
```

